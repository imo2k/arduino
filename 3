int en = 2; // LOW = ON, HIGH = OFF
int step = 3; // HIGH > LOW = 1step
int dir = 4;
const int sensorPin = 8; // 센서가 연결된 디지털 핀
const int ledPin = 13;   // 테스트용 LED가 연결된 핀 (보드의 기본 LED 핀)



void setup() {
  // put your setup code here, to run once:
  pinMode(sensorPin, INPUT_PULLUP); // 센서 핀을 입력으로 설정
  pinMode(ledPin, OUTPUT);          // LED 핀을 출력으로 설정

  pinMode(en, OUTPUT);
  pinMode(step, OUTPUT);
  pinMode(dir, OUTPUT);

  digitalWrite(en, LOW);
  digitalWrite(step, LOW);
  digitalWrite(dir, LOW);

  Serial.begin(9600);

  delay(1000);
}

void loop() {
  // put your main code here, to run repeatedly:
  // 센서 상태 읽기 (LOW = 필라멘트 없음, HIGH = 필라멘트 있음)
  int sensorState = digitalRead(sensorPin);

  // 시리얼 모니터에 센서 상태 출력
  if (sensorState == HIGH) {
    Serial.println("Filament not detected!"); // 필라멘트가 없을 때 메시지 출력
    digitalWrite(ledPin, HIGH); // LED 켜기 (필라멘트 없음 경고)
    while(true)
    {
      digitalWrite(step, HIGH);
      delay(5);
      digitalWrite(step, LOW);
      delay(10);
      if(sensorState == LOW);
      break;
    }
  } else {
    Serial.println("Filament detected!"); // 필라멘트가 있을 때 메시지 출력
    digitalWrite(ledPin, LOW); // LED 끄기 (필라멘트 있음)
  }
  delay(100);
}
